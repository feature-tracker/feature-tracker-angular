<div id="features-tab">
  <p-card>
    <p-table #dt1 [value]="features" dataKey="code">
      <ng-template #caption>
        <div class="flex items-center gap-3">
          <p-button class="font-bold" icon="pi pi-plus-circle"
                    label=" Feature"
                    *ngIf="authService.isLoggedIn()"
                    (click)="showCreateFeatureFormHandler()"
          />
          <p-button icon="pi pi-filter-slash"
                    label="Clear"
                    (click)="clearFilters(dt1)"
          />
        </div>
      </ng-template>
      <ng-template #header>
        <tr>
          <th style="min-width:10rem">
            <div class="flex items-center">
              Code
              <p-columnFilter type="text" field="code" display="menu"
                              showMatchModes="false"
                              showOperator="false"
                              matchMode="contains"
                              showApplyButton="false"
                              showClearButton="false"
                              showAddButton="false"
              />
            </div>
          </th>
          <th style="min-width:15rem">
            <div class="flex items-center">
              Title
              <p-columnFilter type="text" field="title" display="menu"
                              showMatchModes="false"
                              showOperator="false"
                              matchMode="contains"
                              showApplyButton="false"
                              showClearButton="false"
                              showAddButton="false"
              />
            </div>
          </th>
          <th style="min-width:10rem">
            <div class="flex items-center">
              Status
              <p-columnFilter type="text" field="status" display="menu"
                              showMatchModes="false"
                              showOperator="false"
                              matchMode="equals"
                              showApplyButton="false"
                              showClearButton="true"
                              showAddButton="false">
                <ng-template #filter let-value let-filter="filterCallback">
                  <p-select [options]="featureStatuses" (onChange)="filter($event.value)"
                            optionLabel="label" optionValue="value"
                            [ngModel]="value"
                            placeholder="Select One" [showClear]="true" class="w-full md:w-56" />
                </ng-template>
              </p-columnFilter>
            </div>
          </th>
          <th style="min-width:10rem">
            <div class="flex items-center">
              Release
              <p-columnFilter type="text" field="releaseCode" display="menu"
                              showMatchModes="false"
                              showOperator="false"
                              matchMode="equals"
                              showApplyButton="false"
                              showClearButton="true"
                              showAddButton="false">
                <ng-template #filter let-value let-filter="filterCallback">
                  <p-select [options]="releases()" (onChange)="filter($event.value)"
                            optionLabel="code" optionValue="code"
                            [ngModel]="value"
                            placeholder="Select One" [showClear]="true" class="w-full md:w-56" />
                </ng-template>
              </p-columnFilter>
            </div>
          </th>
          <th style="min-width:10rem">
            <div class="flex items-center">
              Assigned To
              <p-columnFilter type="text" field="assignedTo" display="menu"
                              showMatchModes="false"
                              showOperator="false"
                              matchMode="equals"
                              showApplyButton="false"
                              showClearButton="true"
                              showAddButton="false">
                <ng-template #filter let-value let-filter="filterCallback">
                  <p-select [options]="allUsers()" (onChange)="filter($event.value)"
                            optionLabel="fullName" optionValue="username"
                            [ngModel]="value"
                            placeholder="Select One" [showClear]="true" class="w-full md:w-56" />
                </ng-template>
              </p-columnFilter>
            </div>
          </th>
          <th style="width:12%">Actions</th>
        </tr>
      </ng-template>
      <ng-template #body let-feature>
        <tr>
          <td>
            {{ feature.code }}
          </td>
          <td>{{ feature.title }}</td>
          <td>{{ feature.status }}</td>
          <td>{{ feature.releaseCode }}</td>
          <td>{{ getFullNameByUsername(feature.assignedTo) }}</td>
          <td>
            <div class="flex flex-wrap gap-2">
              <p-button size="small" icon="pi pi-pencil"
                        *ngIf="authService.isLoggedIn()"
                        (onClick)="editFeature(feature)"/>
              <a routerLink="/products/{{productCode()}}/features/{{feature.code}}"
              ><p-button size="small" icon="pi pi-search"/></a>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>

  <p-card class="p-5" *ngIf="showCreateFeatureForm">
    <!-- Container -->
    <div class="max-w-5xl">
      <!-- Title -->
      <h2 class="text-2xl font-bold text-center mb-8">Create Feature Form</h2>

      <!-- Form Grid -->
      <form class="grid grid-cols-1 md:grid-cols-3 gap-6"
            [formGroup]="createFeatureForm" id="createFeatureForm" method="post"
            (ngSubmit)="handleCreateFeature()">

        <!-- Left column (Code, Title, Description) -->
        <div class="md:col-span-2 space-y-6">
          <!-- Code -->
          <div>
            <label for="code" class="block text-sm font-medium text-gray-700 mb-1">Code</label>
            <input pInputText id="code" type="text" formControlName="code"
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400"
                   />
          </div>

          <!-- Title -->
          <div>
            <label for="title" class="block text-sm font-medium text-gray-700 mb-1">Title</label>
            <input pInputText id="title" type="text" formControlName="title"
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400"
            />
          </div>

          <!-- Description -->
          <div>
            <label for="description" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
            <textarea id="description" rows="5" cols="30" pTextarea formControlName="description"
                      class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 resize-none"></textarea>
          </div>
        </div>

        <!-- Right column -->
        <div class="md:col-span-1 space-y-6">
          <!-- Release -->
          <div>
            <label for="releaseCode" class="block text-sm font-medium text-gray-700 mb-1">Release</label>
            <p-select id="releaseCode" formControlName="releaseCode" [options]="releases()"
                      optionLabel="code" optionValue="code" class="w-full md:w-56" />

          </div>

          <!-- Assigned To -->
          <div>
            <label for="assignedTo" class="block text-sm font-medium text-gray-700 mb-1">Assigned To</label>
            <p-select id="assignedTo" formControlName="assignedTo" [options]="allUsers()"
                      optionLabel="fullName" optionValue="username" class="w-full md:w-56" />
          </div>
        </div>

        <div class="flex justify-center gap-3">
          <p-button label="Submit" [fluid]="false" type="submit"
                    [disabled]="createFeatureForm.invalid"/>
          <p-button label="Cancel" [fluid]="false" severity="secondary"
                    (onClick)="hideAllForms()"/>
        </div>
      </form>
    </div>

  </p-card>

  <p-card class="p-5" *ngIf="showEditFeatureForm">
    <!-- Container -->
    <div class="max-w-5xl">
      <!-- Title -->
      <h2 class="text-2xl font-bold text-center mb-8">Edit Feature Form</h2>

      <!-- Form Grid -->
      <form class="grid grid-cols-1 md:grid-cols-3 gap-6"
            [formGroup]="editFeatureForm" id="editFeatureForm" method="post" (ngSubmit)="handleUpdateFeature()">

        <!-- Left column (Code, Title, Description) -->
        <div class="md:col-span-2 space-y-6">
          <!-- Code -->
          <div>
            <label for="code" class="block text-sm font-medium text-gray-700 mb-1">Code</label>
            <input pInputText id="code" type="text" formControlName="code"
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400"
                   readonly/>
          </div>

          <!-- Title -->
          <div>
            <label for="title" class="block text-sm font-medium text-gray-700 mb-1">Title</label>
            <input pInputText id="title" type="text" formControlName="title"
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400"
                   />
          </div>

          <!-- Description -->
          <div>
            <label for="description" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
            <textarea id="description" rows="5" cols="30" pTextarea formControlName="description"
                      class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 resize-none"></textarea>
          </div>
        </div>

        <!-- Right column -->
        <div class="md:col-span-1 space-y-6">
          <!-- Status -->
          <div>
            <label for="status" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
            <p-select id="status" formControlName="status" [options]="featureStatuses"
                      optionLabel="label" optionValue="value" class="w-full md:w-56" />

          </div>
          <!-- Release -->
          <div>
            <label for="releaseCode" class="block text-sm font-medium text-gray-700 mb-1">Release</label>
            <p-select id="releaseCode" formControlName="releaseCode" [options]="releases()"
                      optionLabel="code" optionValue="code" class="w-full md:w-56" />

          </div>

          <!-- Assigned To -->
          <div>
            <label for="assignedTo" class="block text-sm font-medium text-gray-700 mb-1">Assigned To</label>
            <p-select id="assignedTo" formControlName="assignedTo" [options]="allUsers()"
                      optionLabel="fullName" optionValue="username" class="w-full md:w-56" />
          </div>
        </div>

        <div class="flex justify-center gap-3">
          <p-button label="Submit" [fluid]="false" type="submit"
                    [disabled]="editFeatureForm.invalid"/>
          <p-button label="Cancel" [fluid]="false" severity="secondary"
                    (onClick)="hideAllForms()"/>
        </div>
      </form>
    </div>

  </p-card>

</div>
