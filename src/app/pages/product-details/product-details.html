<div>
  <div class="h-35">
    <a href="{{'/products/'+product.code}}">
      <img src="{{product.imageUrl}}"
           alt="{{product.name}}"
           class="h-30">
    </a>
  </div>

  <p-card class="card">
    <p-tabs value="0">
      <p-tablist>
        <p-tab value="0">Features</p-tab>
        <p-tab value="1">Releases</p-tab>
      </p-tablist>
      <p-tabpanels>
        <p-tabpanel value="0">
          <p-card class="p-5">
            <p-table [value]="features" stripedRows>
              <ng-template #caption>
                <div class="flex items-center justify-between">
                  <p-button class="font-bold"
                     *ngIf="authService.isLoggedIn()"
                     (click)="showCreateFeatureFormHandler()"
                  > <span class="pi pi-plus-circle"></span> Feature</p-button>
                </div>
              </ng-template>
              <ng-template #header>
                <tr>
                  <th>Code</th>
                  <th>Title</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </ng-template>
              <ng-template #body let-feature>
                <tr>
                  <td>
                    {{ feature.code }}
                  </td>
                  <td>{{ feature.title }}</td>
                  <td>{{ feature.status }}</td>
                  <td>
                    <div class="flex flex-wrap gap-2">
                    <p-button size="small" icon="pi pi-pencil"
                              *ngIf="authService.isLoggedIn()"
                              (onClick)="editFeature(feature)"/>
                      <a routerLink="/products/{{product.code}}/features/{{feature.code}}"
                      ><p-button size="small" icon="pi pi-search"/></a>
                    </div>
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </p-card>

          <p-card class="p-5" *ngIf="showCreateFeatureForm">
            <form [formGroup]="createFeatureForm" id="createFeatureForm" method="post" (ngSubmit)="handleCreateFeature()">
            <div class="card flex flex-col gap-4">
              <div class="font-semibold text-xl">Create Feature</div>
              <div class="flex flex-col gap-2">
                <label for="code">Code</label>
                <input pInputText id="code" type="text" formControlName="code"/>
              </div>
              <div class="flex flex-col gap-2">
                <label for="title">Title</label>
                <input pInputText id="title" type="text" formControlName="title"/>
              </div>
              <div class="flex flex-col gap-2">
                <label for="description">Description</label>
                <input pInputText id="description" type="text" formControlName="description"/>
              </div>
              <div class="flex flex-col gap-2">
                <label for="assignedTo">Assigned To</label>
                <p-select formControlName="assignedTo" [options]="allUsers"
                          optionLabel="fullName" optionValue="uuid" class="w-full md:w-56" />
              </div>
              <div class="flex flex-col gap-2">
                <p-button label="Submit" [fluid]="false" type="submit"
                          [disabled]="createFeatureForm.invalid"></p-button>
              </div>
            </div>
            </form>
          </p-card>

          <p-card class="p-5" *ngIf="showEditFeatureForm">
            <form [formGroup]="editFeatureForm" id="editFeatureForm" method="post" (ngSubmit)="handleUpdateFeature()">
              <div class="card flex flex-col gap-4">
                <div class="font-semibold text-xl">Edit Feature</div>
                <div class="flex flex-col gap-2">
                  <label for="code">Code</label>
                  <input pInputText id="code" type="text" formControlName="code" readonly/>
                </div>
                <div class="flex flex-col gap-2">
                  <label for="title">Title</label>
                  <input pInputText id="title" type="text" formControlName="title"/>
                </div>
                <div class="flex flex-col gap-2">
                  <label for="description">Description</label>
                  <input pInputText id="description" type="text" formControlName="description"/>
                </div>
                <div class="flex flex-col gap-2">
                  <label for="status">Status</label>
                  <p-select formControlName="status" [options]="featureStatuses"
                            optionLabel="label" optionValue="value" class="w-full md:w-56" />
                </div>
                <div class="flex flex-col gap-2">
                  <label for="assignedTo">Assigned To</label>
                  <p-select formControlName="assignedTo" [options]="allUsers"
                            optionLabel="fullName" optionValue="uuid" class="w-full md:w-56" />
                </div>
                <div class="flex flex-col gap-2">
                  <p-button label="Submit" [fluid]="false" type="submit"
                            [disabled]="editFeatureForm.invalid"
                  ></p-button>
                </div>
              </div>
            </form>
          </p-card>

        </p-tabpanel>

        <p-tabpanel value="1">
          <p-card class="p-5">
            <p-table [value]="releases" stripedRows [tableStyle]="{ 'min-width': '50rem' }">
              <ng-template #caption>
                <div class="flex items-center justify-between">
                  <p-button class="font-bold"
                     *ngIf="authService.isLoggedIn()"
                     (click)="showCreateReleaseFormHandler()"
                  ><span class="pi pi-plus-circle"></span>  Release</p-button>
                </div>
              </ng-template>
              <ng-template #header>
                <tr>
                  <th>Code</th>
                  <th>Description</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </ng-template>
              <ng-template #body let-release>
                <tr>
                  <td>
                    {{ release.code }}
                  </td>
                  <td>{{ release.description }}</td>
                  <td>{{ release.status }}</td>
                  <td>
                    <div class="flex flex-wrap gap-2">
                    <p-button size="small" icon="pi pi-pencil"
                              *ngIf="authService.isLoggedIn()"
                              (onClick)="editRelease(release)"/>
                      <a href="{{'/products/'+product.code+'/releases/'+release.code}}"><p-button size="small" icon="pi pi-search"/></a>
                    </div>
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </p-card>

          <p-card class="p-5" *ngIf="showCreateReleaseForm">
            <form [formGroup]="createReleaseForm" id="createReleaseForm" method="post" (ngSubmit)="handleCreateRelease()">
            <div class="card flex flex-col gap-4">
              <div class="font-semibold text-xl">Create Release</div>
              <div class="flex flex-col gap-2">
                <label for="code">Code</label>
                <input pInputText id="code" type="text" formControlName="code"/>
              </div>
              <div class="flex flex-col gap-2">
                <label for="description">Description</label>
                <input pInputText id="description" type="text" formControlName="description"/>
              </div>
              <div class="flex flex-col gap-2">
                <p-button label="Submit" [fluid]="false" type="submit"
                          [disabled]="createReleaseForm.invalid"></p-button>
              </div>
            </div>
            </form>
          </p-card>

          <p-card class="p-5" *ngIf="showEditReleaseForm">
            <form [formGroup]="editReleaseForm" id="editReleaseForm" method="post" (ngSubmit)="handleUpdateRelease()">
              <div class="card flex flex-col gap-4">
                <div class="font-semibold text-xl">Edit Release</div>
                <div class="flex flex-col gap-2">
                  <label for="code">Code</label>
                  <input pInputText id="code" type="text" formControlName="code" readonly/>
                </div>
                <div class="flex flex-col gap-2">
                  <label for="description">Description</label>
                  <input pInputText id="description" type="text" formControlName="description"/>
                </div>
                <div class="flex flex-col gap-2">
                  <label for="status">Status</label>
                  <p-select formControlName="status" [options]="releaseStatuses"
                            optionLabel="label" optionValue="value" class="w-full md:w-56" />
                </div>
                <div class="flex flex-col gap-2">
                  <p-button label="Submit" [fluid]="false" type="submit"
                            [disabled]="editReleaseForm.invalid"></p-button>
                </div>
              </div>
            </form>
          </p-card>

        </p-tabpanel>
      </p-tabpanels>
    </p-tabs>
  </p-card>
</div>
